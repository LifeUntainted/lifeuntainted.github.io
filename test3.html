<!DOCTYPE html>
<html>
<head>
  <title>GPT-4 Turbo Chat with Debugging</title>
  <style>
    /* Styling for the dark theme */
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
    }

    #chatbox {
      width: 400px;
      height: 300px;
      border: 1px solid #57FF8C;
      overflow-y: scroll;
      padding: 10px;
      background-color: #1c1c1c;
      color: #57FF8C;
    }

    #user_input {
      width: 300px;
      background-color: #1c1c1c;
      color: #57FF8C;
      border: 1px solid #57FF8C;
      padding: 5px;
    }

    button {
      background-color: #57FF8C;
      color: #000;
      padding: 5px 10px;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #45D679;
    }

    #debugBox {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #57FF8C;
      background-color: #1c1c1c;
      color: #57FF8C;
      width: 400px;
      height: 150px;
      overflow-y: scroll;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <h1>GPT-4 Turbo Chat</h1>
  <div id="chatbox"></div>
  <input type="text" id="user_input" placeholder="Type your message...">
  <button onclick="sendMessage()">Send</button>
  
  <div id="debugBox">
    <strong>Debug Information:</strong>
    <div id="debug"></div>
  </div>

  <script type="module">
    async function sendMessage() {
      const userInput = document.getElementById("user_input").value;
      document.getElementById("user_input").value = "";

      displayMessage("user", userInput);
      appendDebugInfo("User input: " + userInput);

      try {
        // Send data to the backend API
        const response = await fetch('https://niche-analyzer-api-321niche-projects.vercel.app/api/nicheAnalyzer', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            messages: [{ role: "user", content: userInput }],
          })
        });

        appendDebugInfo("Request sent to backend.");

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        appendDebugInfo("Response received: " + JSON.stringify(data));

        if (data && data.choices && data.choices.length > 0) {
          displayMessage("assistant", data.choices[0].message.content);
        } else {
          displayMessage("error", "Unexpected response format.");
        }
      } catch (error) {
        console.error("Error:", error);
        appendDebugInfo("Error: " + error.message);
        displayMessage("error", "An error occurred. Please try again.");
      }
    }

    function displayMessage(role, message) {
      const chatbox = document.getElementById("chatbox");
      const div = document.createElement("div");
      div.innerHTML = `<strong>${role}:</strong> ${message}`;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function appendDebugInfo(info) {
      const debug = document.getElementById("debug");
      const div = document.createElement("div");
      div.textContent = info;
      debug.appendChild(div);
      debug.scrollTop = debug.scrollHeight;
    }
  </script>
</body>
</html>
